{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Reports | Team Expense Tracker</title>
  <link href="{% static 'css/tailwind.min.css' %}" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/chart-fixes.css' %}">
  <script src="{% static 'js/chart.min.js' %}"></script>
  <link href="https://fonts.cdnfonts.com/css/mona-sans" rel="stylesheet" />
  <style>
    :root { --brand:#075131; }
    body { font-family: 'Mona-Sans', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .brand-bg { background-color: var(--brand); }
    .brand-bg-hover:hover { background-color: #06412a; }
    .brand-text { color: var(--brand); }
  </style>
</head>
<body class="min-h-screen h-full bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 antialiased">

  <!-- Navbar -->
  <nav id="appHeader" class="sticky top-0 z-50 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between">
        <a href="{% url 'dashboard' %}" class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg brand-bg text-white shadow-sm">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 17v-2a4 4 0 014-4h5a4 4 0 014 4v2" />
              <path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4V7z" />
            </svg>
          </span>
          <span class="text-lg font-semibold tracking-tight">Team Expense Tracker</span>
        </a>
        <div class="flex items-center gap-3">
          <span class="hidden sm:block text-sm font-medium">ğŸ‘¤ {{ request.user.first_name }}</span>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="inline-flex items-center rounded-lg brand-bg brand-bg-hover text-white px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-800 transition" aria-label="Logout">
              Logout
            </button>
          </form>
        </div>
      </div>
    </div>
  </nav>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="hidden lg:block w-64 min-h-[calc(100vh-4rem)] text-white shadow-lg" style="background-color: var(--brand);">
      <div class="p-6">
        
        <nav class="space-y-2 text-sm">
          <a href="{% url 'dashboard' %}" class="flex items-center gap-2 px-4 py-3 w-full rounded-lg border border-white/30 transition {% if request.resolver_match.url_name == 'dashboard' %}bg-white text-green-700 font-medium{% else %}hover:bg-white/10 text-white/90{% endif %}"><span>ğŸ“Š</span> Dashboard</a>
          <a href="{% url 'add_expense' %}" class="flex items-center gap-2 px-4 py-3 w-full rounded-lg border border-white/30 transition {% if request.resolver_match.url_name == 'add_expense' %}bg-white text-green-700 font-medium{% else %}hover:bg-white/10 text-white/90{% endif %}"><span>â•</span> Add Expense</a>
          <a href="{% url 'reports' %}" class="flex items-center gap-2 px-4 py-3 w-full rounded-lg border border-white/30 transition {% if request.resolver_match.url_name == 'reports' %}bg-white text-green-700 font-medium{% else %}hover:bg-white/10 text-white/90{% endif %}"><span>ğŸ“ˆ</span> Reports</a>
          <a href="{% url 'my_submissions' %}" class="flex items-center gap-2 px-4 py-3 w-full rounded-lg border border-white/30 transition {% if request.resolver_match.url_name == 'my_submissions' %}bg-white text-green-700 font-medium{% else %}hover:bg-white/10 text-white/90{% endif %}"><span>ğŸ“</span> My Submissions</a>
          <a href="{% url 'invoice_generator' %}" class="flex items-center gap-2 px-4 py-3 w-full rounded-lg border border-white/30 transition {% if request.resolver_match.url_name == 'my_submissions' %}bg-white text-green-700 font-medium{% else %}hover:bg-white/10 text-white/90{% endif %}">ğŸ§¾ Invoice Generator</a>

        </nav>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1">
      <div class="max-w-7xl mx-auto p-6 lg:p-10">
        <h2 class="text-3xl font-bold tracking-tight brand-text mb-8">Expense Reports</h2>

        <form method="post" class="mb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 items-end">
          {% csrf_token %}
          <div>
            <label for="rangeSelect" class="block text-sm font-medium mb-1">Select Report Range</label>
            <select name="range" id="rangeSelect" class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="quarterly">Quarterly</option>
              <option value="half_yearly">Half-Yearly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Download Format</label>
            <select name="format" class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
              <option value="html">View On Page</option>
              <option value="pdf">Download PDF</option>
              <option value="excel">Download Excel</option>
            </select>
          </div>
          <div>
            <button type="submit" class="w-full sm:w-auto inline-flex items-center justify-center rounded-lg brand-bg brand-bg-hover px-5 py-2.5 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-offset-2 transition">Generate Report</button>
          </div>
        </form>

        <div class="mt-6 rounded-xl bg-white dark:bg-gray-800 p-5 shadow ring-1 ring-gray-900/5 dark:ring-white/10">
          <h3 class="text-base font-semibold mb-4">Expenses by Category</h3>
          <div class="chart-wrapper reports-chart">
            <canvas id="categoryChart" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="{% static 'js/charts.js' %}"></script>
  <script>
    (function() {
      const root = document.documentElement;
      const stored = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = stored ? stored === 'dark' : prefersDark;
      root.classList.toggle('dark', isDark);
      window.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('themeToggle');
        if (!btn) return;
        btn.setAttribute('aria-pressed', String(root.classList.contains('dark')));
        btn.addEventListener('click', function() {
          const nowDark = !root.classList.contains('dark');
          root.classList.toggle('dark', nowDark);
          localStorage.setItem('theme', nowDark ? 'dark' : 'light');
          this.setAttribute('aria-pressed', String(nowDark));
        });
      });
    })();
    
    // Header background on scroll
    (function() {
      const header = document.getElementById('appHeader');
      const onScroll = () => {
        if (window.scrollY > 10) {
          header.classList.add('bg-white','shadow-md');
        } else {
          header.classList.remove('bg-white','shadow-md');
        }
      };
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    })();
  </script>
</body>
</html>